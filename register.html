<!DOCTYPE html>
<html>
<head>
    <title>Electricity Bill Calculator - Sign Up</title>
    <link rel="stylesheet" href="signingin.css">
</head>

<body>

<!-- NAV BAR -->
<div class="nav">
    <h1>Signing In</h1>
    <img src="callogo1.png" alt="logo">
</div>

<!-- SIGN UP FORM -->
<div class="user_info">

    <div class="username">
        <input type="text" placeholder="name" id="reg_name">
    </div>

    <div class="useradd"> 
        <input type="text" placeholder="address" id="reg_address">
    </div>

    <div class="usernum">
        <input type="text" placeholder="phone" id="reg_phone">
    </div>

    <div class="usermail">
        <input type="text" placeholder="email" id="reg_email">
    </div>

    <div class="userpass">
        <input type="password" placeholder="password" id="reg_password">
    </div>

    <div class="userconfirm">
        <input type="password" placeholder="confirm password" id="reg_confirm_password">
    </div>

</div>

<!-- SIGN UP BUTTON -->
<div class="sign">
    <button type="button" onclick="handleRegister()">Sign Up</button>
</div>

<!-- BACK BUTTON -->
<div class="bck">
    <a href="index.html"><img src="back2.png"></a>
</div>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>
<script src="auth.js"></script>

<script>

    document.addEventListener("DOMContentLoaded", async () => {
        await redirectIfAuthenticated();
    });

    async function handleRegister() {
        const name = document.getElementById("reg_name").value;
        const email = document.getElementById("reg_email").value;
        const password = document.getElementById("reg_password").value;
        const confirmPassword = document.getElementById("reg_confirm_password").value;

        if (!name || !email || !password || !confirmPassword) {
            alert("Please fill in all fields!");
            return;
        }

        if (password !== confirmPassword) {
            alert("Passwords do not match!");
            return;
        }

        if (password.length < 6) {
            alert("Password must be at least 6 characters long!");
            return;
        }

        try {
            const { data, error } = await supabaseClient.auth.signUp({
                email: email,
                password: password,
                options: {
                    data: {
                        full_name: name
                    }
                }
            });

            if (error) {
                alert("Registration failed: " + error.message);
                return;
            }

            alert("Registration successful! Check your email to verify your account.");
            window.location.href = "login.html";

        } catch (err) {
            alert("An error occurred: " + err.message);
        }
    }

    async function redirectIfAuthenticated() {
        const session = await checkAuth();
        if (session) {
            window.location.href = "calculator_page.html";
        }
    }

</script>

</body>
</html>
